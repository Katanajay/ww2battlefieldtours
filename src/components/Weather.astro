---
const { locationName, lat, lon } = Astro.props;

const apiUrl = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true&daily=temperature_2m_max,temperature_2m_min,weathercode,windspeed_10m_max&timezone=auto&forecast_days=5`;

const response = await fetch(apiUrl);
const data = await response.json();

const weather = data.current_weather;
const daily = data.daily;

// I added this Weather Widget but I didn`t like the style so i got help on reddit to alter the style with icons //
function getWeatherDescription(code) {
  const map = {
    0: "Clear â˜€ï¸",
    1: "Mainly clear ğŸŒ¤ï¸",
    2: "Partly cloudy â›…",
    3: "Overcast â˜ï¸",
    45: "Fog ğŸŒ«ï¸",
    48: "Rime fog ğŸŒ«ï¸",
    51: "Light drizzle ğŸŒ¦ï¸",
    53: "Moderate drizzle ğŸŒ¦ï¸",
    55: "Dense drizzle ğŸŒ¦ï¸",
    61: "Light rain ğŸŒ§ï¸",
    63: "Moderate rain ğŸŒ§ï¸",
    65: "Heavy rain ğŸŒ§ï¸",
    71: "Light snow â„ï¸",
    73: "Moderate snow â„ï¸",
    75: "Heavy snow â„ï¸",
    77: "Snow grains â„ï¸",
    80: "Light showers ğŸŒ¦ï¸",
    81: "Moderate showers ğŸŒ¦ï¸",
    82: "Violent showers ğŸŒ§ï¸",
    85: "Light snow showers â„ï¸",
    86: "Heavy snow showers â„ï¸",
    95: "Thunderstorm â›ˆï¸",
    96: "Storm w/ hail ğŸŒ©ï¸",
    99: "Severe storm w/ hail ğŸŒ©ï¸",
  };
  return map[code] || "Unknown ğŸŒ";
}
---

<div class="weather-box">
  <h2>Weather in {locationName}</h2>

  {
    weather ? (
      <div class="weather-info">
        <p>
          <strong>Now:</strong> {weather.temperature}Â°C,{" "}
          {getWeatherDescription(weather.weathercode)}, {weather.windspeed} km/h
          winds
        </p>
      </div>
    ) : (
      <p>Weather data not available</p>
    )
  }

  {
    daily ? (
      <div class="forecast">
        <h3>5-Day Forecast</h3>
        <div class="forecast-cards">
          {daily.time.map((date, i) => (
            <div class="forecast-card">
              <p class="date">
                {new Date(date).toLocaleDateString(undefined, {
                  weekday: "short",
                  day: "numeric",
                  month: "short",
                })}
              </p>
              <p class="icon">{getWeatherDescription(daily.weathercode[i])}</p>
              <p>
                ğŸŒ¡ï¸ {daily.temperature_2m_min[i]}Â° /{" "}
                {daily.temperature_2m_max[i]}Â°C
              </p>
              <p>ğŸ’¨ {daily.windspeed_10m_max[i]} km/h</p>
            </div>
          ))}
        </div>
      </div>
    ) : null
  }
</div>

<style>
  .weather-box {
    background: rgba(0, 0, 0, 0.65);
    color: #fff;
    border-radius: 12px;
    padding: 1rem;
    margin: 1rem auto;
    max-width: 700px;
    text-align: center;
    font-family: Arial, sans-serif;
  }

  .weather-box h2 {
    font-size: 1.3rem;
    margin-bottom: 0.5rem;
  }

  .weather-info {
    margin-bottom: 1rem;
  }

  .forecast h3 {
    margin-top: 1rem;
    font-size: 1rem;
    text-decoration: underline;
  }

  .forecast-cards {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
    gap: 0.75rem;
    margin-top: 0.5rem;
  }

  .forecast-card {
    background: rgba(255, 255, 255, 0.1);
    border-radius: 10px;
    padding: 0.5rem;
    font-size: 0.9rem;
  }

  .forecast-card .date {
    font-weight: bold;
    margin-bottom: 0.25rem;
  }

  .forecast-card .icon {
    font-size: 1.2rem;
    margin: 0.25rem 0;
  }
</style>
